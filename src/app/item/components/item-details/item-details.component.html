<div *ngIf="item" class="flex flex-col justify-center min-h-5/6 pt-10 overflow-auto">
    <div class="font-bold text-2xl pb-10 flex flex-row justify-between">
        <h2>Détails: </h2>
        <div>
            <a mat-button mat-flat-button color="accent" (click)="getAsPdf()" class="mr-4">Imprimer</a>
            <a mat-button mat-flat-button color="accent" (click)="goToInterventionCreation()">Nouvelle opération</a>
        </div>
    </div>
    <div id="pdfContainer" #pdfContainer>
    <div class="grid gap-6 sm:grid-cols-3 font-bold text-xl">
        <!--COL 1-->
        <div class="">
            <p class="pb-2">{{item.name}} | {{item.reference}}</p>
            <p class="pb-2">({{item.type.name}})</p>
            <p class="pb-5">{{item.room.unit.name}} | {{item.room.name}}</p>
        </div>
        <div class="flex flex-col justify-center align-middle items-center">
            <qrcode
            [qrdata]="getQRCodeUrl()"
            [allowEmptyString]="true"
            [ariaLabel]="'QR Code for item'"
            [cssClass]="'center'"
            [colorDark]="'#003e8f'"
            [colorLight]="'#fafafa'"
            [elementType]="'canvas'"
            [errorCorrectionLevel]="'M'"
            [imageSrc]="'./assets/CHRV_Logo.png'"
            [imageHeight]="45"
            [imageWidth]="45"
            [margin]="1"
            [scale]="4"
            [title]="'Item Name'"
            [width]="200"
          ></qrcode>
        </div>
        <!--COL 3-->
        <div class="flex sm:flex-col justify-between sm:items-end">
            <a (click)="togglePlacement()" *ngIf="item.isPlaced" [ngClass]="{'cursor-pointer':!is_locked}" class="w-24 h-6 flex text-center content-center align-middle items-center justify-center bg-red-100 text-red-800 text-xs font-medium mr-2 px-2.5 py-0.5 rounded-full dark:bg-red-900 dark:text-red-300">Installé</a>
            <a (click)="togglePlacement()" *ngIf="!item.isPlaced" [ngClass]="{'cursor-pointer':!is_locked}" class="w-24 h-6 flex text-center content-center align-middle items-center justify-center bg-green-100 text-green-800 text-xs font-medium mr-2 px-2.5 py-0.5 rounded-full dark:bg-green-900 dark:text-green-300">Pas installé</a>
            <a (click)="toggleAvailability()" *ngIf="item.isAvailable" [ngClass]="{'cursor-pointer':!is_locked}" class="w-24 h-6 flex text-center content-center align-middle items-center justify-center bg-green-100 max-w-sm text-green-800 text-xs font-medium mr-2 px-2.5 py-0.5 rounded-full dark:bg-green-900 dark:text-green-300">Disponible</a>    
            <a (click)="toggleAvailability()" *ngIf="!item.isAvailable" [ngClass]="{'cursor-pointer':!is_locked}" class="w-24 h-6 flex text-center content-center align-middle items-center justify-center bg-red-100 text-red-800 text-xs font-medium mr-2 px-2.5 py-0.5 rounded-full dark:bg-red-900 dark:text-red-300">Indisponible</a>
        </div>
        </div>
            <div class="py-4">
                <hr class="">
            </div>
        <form>
            <div class="grid gap-6 mb-6 md:grid-cols-2">
                <div>
                    <label for="name" class="form-control block mb-2 text-sm font-medium text-gray-900 dark:text-white">Nom DNS</label>
                    <input name="name" [disabled]="is_locked" [(ngModel)]="item.name" placeholder="name" type="text" id="name" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500">
                </div>
                <div>
                    <label for="serial_number" class="form-control block mb-2 text-sm font-medium text-gray-900 dark:text-white">Numéro de série</label>
                    <input name="serial_number" [disabled]="is_locked" [(ngModel)]="item.serialNumber" placeholder="serial_number" type="text" id="serial_number" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500">
                </div>
                <div>
                    <label for="description" class="form-control block mb-2 text-sm font-medium text-gray-900 dark:text-white">Description</label>
                    <input name="description" [disabled]="is_locked" [(ngModel)]="item.description" placeholder="description" type="text" id="description" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500">
                </div>
                <div *ngIf="is_locked">
                    <div>
                        <label class="form-control block mb-2 text-sm font-medium text-gray-900 dark:text-white">Type</label>
                        <input [disabled]="is_locked" placeholder="type" type="text" id="type" value="{{item.type.name}}" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500">
                    </div>
                </div>
                <div *ngIf="!is_locked">
                    <mat-label>Type</mat-label>
                    <mat-select *ngIf="types" [(value)]="item.type.id" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500">
                        <mat-option>--</mat-option>
                        <mat-option *ngFor="let type of types" [value]="type.id">
                        {{type.name}}
                        </mat-option>
                    </mat-select>
                </div>
                <div>
                    <label for="provider" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Fournisseur</label>
                    <input name="provider" [disabled]="is_locked" [(ngModel)]="item.provider" placeholder="provider" disabled type="text" id="provider" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500">
                </div>
                <div>
                    <label for="price" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Prix</label>
                    <input name="price" [disabled]="is_locked" [(ngModel)]="item.price" placeholder="price" type="number" step="0.01" min="0" id="price" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500">
                </div>
            </div>
            <div class="py-4">
                <hr class="">
            </div>
            <div class="grid gap-6 mb-6 md:grid-cols-2">
                <div>
                    <label for="purchased_at" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Date d'achat</label>
                    <input name="purchased_at" [disabled]="is_locked" [ngModel]="item.purchasedAt| date:'yyyy-MM-dd'" (ngModelChange)="item.purchasedAt=$event" type="date" id="purchased_at" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500">
                </div>
                <div>
                    <label for="received_at" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Date de réception</label>
                    <input name="purchased_at" placeholder="received_at" [disabled]="is_locked" [ngModel]="item.receivedAt| date:'yyyy-MM-dd'" (ngModelChange)="item.receivedAt=$event" type="date" id="received_at" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500">
                </div>
                <div>
                    <label for="warranty_expires_at" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Date fin de garantie</label>
                    <input name="warranty_expires_at" [disabled]="is_locked" [ngModel]="item.warrantyExpiresAt | date:'yyyy-MM-dd'" (ngModelChange)="item.warrantyExpiresAt=$event" type="date" placeholder="warranty_expires_at" id="warranty_expires_at" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500">
                </div>
                <div>
                    <label for="last_checkup_at" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Dernière maintenance</label>
                    <input name="last_checkup_at" [disabled]="is_locked" [ngModel]="item.lastCheckupAt | date:'yyyy-MM-dd'" (ngModelChange)="item.lastCheckupAt=$event" type="date" placeholder="last_checkup_at" id="last_checkup_at" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500">
                </div>
                <div>
                    <label for="checkup_interval" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Interval de maintenance</label>
                    <input name="checkup_interval" [disabled]="is_locked" [(ngModel)]="item.checkupInterval" type="number" min="1" step="1" placeholder="checkup_interval" id="checkup_interval" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500">
                </div>
            </div>
            <div *ngIf="!is_printing" class="py-4">
                <hr class="">
            </div>
            <div *ngIf="!is_printing" class="flex flex-row-reverse justify-between">
                <div *ngIf="!is_locked" class="flex flex-row-reverse mb-6">
                    <button (click)="put()" mat-button mat-flat-button color="primary">Valider</button>
                </div>
                <div *ngIf="is_locked && auth.hasAuthority('PGM')" class="flex flex-row-reverse mb-6">
                    <a (click)="toggleLock()" mat-button mat-flat-button color="accent">Modifier</a>
                </div>
                <div *ngIf="!is_locked" class="flex flex-row-reverse mb-6">
                    <a (click)="toggleLock()" mat-button mat-flat-button color="warn">Annuler</a>
                </div>
            </div>
            <div *ngIf="!is_printing" class="py-4">
                <hr class="">
            </div>
            <div *ngIf="interventions.length>0" class="max-w-full overflow-auto">
                <div class="font-bold text-xl pb-4 ">
                    <h2>Opérations:</h2>
                </div>
                <table class="table-auto w-full">
                    <thead class="text-left">
                    <tr>
                        <th class="p-2 sm:p-3">Type</th>
                        <th class="p-2 sm:p-3">Ticket</th>
                        <th class="p-2 sm:p-3">Utilisateur</th>
                        <th class="p-2 sm:p-3 max-w-[250px]">Description</th>
                        <th class="p-2 sm:p-3">Date</th>
                        <th class="p-2 sm:p-3">Emplacement</th>
                        <th *ngIf="!is_printing" class="p-2 sm:p-3">Actions</th>
                    </tr>
                    </thead>
                    <tbody *ngIf="interventions.length>0" class="text-left">
                    <tr *ngFor="let intervention of interventions" class="w-full">
                        <td class="p-2 sm:p-3">{{intervention.type.name}}</td>
                        <td class="p-2 sm:p-3">
                            <a *ngIf="intervention.ticketNumber" href="https://jira.chrverviers.be/browse/{{intervention.ticketNumber}}" target="_blank">{{intervention.ticketNumber}}</a>
                            <p *ngIf="!intervention.ticketNumber">Pas de ticket</p>
                        </td>
                        <td class="p-2 sm:p-3">{{intervention.user.firstname}} {{intervention.user.lastname}}</td>
                        <td class="p-2 sm:p-3">{{intervention.description}}</td>
                        <td class="p-2 sm:p-3">{{intervention.actualDate|date:'dd-MM-yyyy'}}</td>
                        <td class="p-2 sm:p-3">{{intervention.room.unit.name}} | {{intervention.room.name}}</td>
                        <td *ngIf="!is_printing" class="p-2 sm:p-3 flex flex-row justify-between">
                            <button mat-button mat-flat-button color="accent" class="mr-4" (click)="goToIntervention(intervention)">Détails</button>
                            <button *ngIf="!intervention.ticketNumber" mat-button mat-flat-button color="accent" (click)="generateTicket(intervention)">Ticket</button>
                        </td>
                    </tr>
                    </tbody>
                </table>
            </div>
            <div *ngIf="!is_printing" class="py-4">
                <hr class="">
            </div>
            <div *ngIf="itemLicences.length>0" class="grid gap-6 mb-6 md:grid-cols-5">
                <div class="font-bold text-xl pb-4 ">
                    <h2>Licences:</h2>
                </div>
            </div>
            <div *ngIf="itemLicences.length>0" class="max-w-full overflow-auto">
                <table class="table-auto w-full">
                    <thead class="text-left">
                    <tr>
                        <th class="p-3">Type</th>
                        <th class="p-3">Référence</th>
                        <th class="p-3">Valeur</th>
                        <th class="p-3">Utilisateur</th>
                    </tr>
                    </thead>
                    <tbody class="text-left">
                    <tr *ngFor="let licence of itemLicences">
                        <td class="p-3">{{licence.type.name}}</td>
                        <td class="p-3">{{licence.reference}}</td>
                        <td class="p-3">{{licence.value}}</td>
                        <td class="p-3">{{licence.user?.firstname}} {{licence.user?.lastname}}</td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </form>
        <div class="py-4">
        </div>
    </div>
</div>